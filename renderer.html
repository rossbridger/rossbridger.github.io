<!DOCTYPE html>
<html>
<head>
    <title>My WebGPU renderer</title>
    <script type="text/plain" src="shader.wgsl" id="shader" , crossorigin="anonymous"></script>
    <script type="text/javascript" src="renderer.js"></script>
    <script type="text/javascript">
        "use strict";
        let canvas;
        let dragging = false;  // set to true when a drag action is in progress.
        let startX, startY;    // coordinates of mouse at start of drag.
        let prevX, prevY;      // previous mouse position during a drag.
        
        function init() {
            try {
                let canvas = document.getElementById("canvas");
            } catch (e) {
                document.getElementById("canvasholder").innerHTML =
                    "<p>Canvas graphics is not supported.<br>" +
                    "An error occurred while initializing graphics.</p>";
                return;
            }
            document.addEventListener("mousedown", doMouseDown);
        }


        function doMouseDown(evt) {
            // This function is called when the user presses a button on the mouse.
            // Only the main mouse button will start a drag.
            if (dragging) {
                return;  // if a drag is in progress, don't start another.
            }
            if (evt.button != 0) {
                return;  // don't respond unless the button is the main (left) mouse button.
            }
            const r = canvas.getBoundingClientRect();
            const x = Math.round(evt.clientX - r.left);  // translate mouse position from screen coords to canvas coords.
            const y = Math.round(evt.clientY - r.top);   // round to integer values; some browsers would give non-integers.
            dragging = true;  // (this won't be the case for all mousedowns in all programs)
            if (dragging) {
                startX = prevX = x;
                startY = prevY = y;
                document.addEventListener("mousemove", doMouseMove, false);
                document.addEventListener("mouseup", doMouseUp, false);
            }
        }

        function doMouseMove(evt) {
            // This function is called when the user moves the mouse during a drag.
            if (!dragging) {
                return;  // (shouldn't be possible)
            }
            const r = canvas.getBoundingClientRect();
            const x = Math.round(evt.clientX - r.left);   // (x,y) mouse position in canvas coordinates
            const y = Math.round(evt.clientY - r.top);


            prevX = x;  // update prevX,prevY to prepare for next call to doMouseMove
            prevY = y;
        }

        function doMouseUp(evt) {
            // This function is called when the user releases a mouse button during a drag.
            if (!dragging) {
                return;  // (shouldn't be possible)
            }
            dragging = false;
            document.removeEventListener("mousemove", doMouseMove, false);
            document.removeEventListener("mouseup", doMouseMove, false);
        }

        window.onload = init; // arranges for function init to be called when page is loaded
    </script>
</head>
<body>
    <canvas id="canvas" width="640" height="480"></canvas>
</body>
</html>